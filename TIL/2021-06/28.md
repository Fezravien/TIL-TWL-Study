# Today I Learned ğŸ”¥



### ì˜¤ëŠ˜ ë­ í–ˆì§€ â‰ï¸

ìº í”„ ë°©í•™ì´ ë“œë””ì–´ ëë‚˜ê³  ìƒˆë¡œìš´ ì›”ìš”ì¼ì´ ë‹¤ê°€ì™”ë‹¤

ì˜¤ëŠ˜ì€ ì•¨ëŸ°ì˜ `GCD / Operation - ë™ì‹œì„± í”„ë¡œê·¸ë˜ë° ì‹¬í™”` í•™ìŠµí™œë™ì„ í–ˆëŠ”ë°... ì–´ë µë‹¤ ã… 



## 1. ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹

### 1-1. ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹ì˜ ê°œë…

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5a21c9cf-10a7-484b-9189-74c2bda94bc2/_2021-06-28__9.47.44.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5a21c9cf-10a7-484b-9189-74c2bda94bc2/_2021-06-28__9.47.44.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2ac7789b-d118-4b42-af55-0f061a8897f0/_2021-06-28__9.47.57.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2ac7789b-d118-4b42-af55-0f061a8897f0/_2021-06-28__9.47.57.png)

ex) ëŸ°ì¹˜ìŠ¤í¬ë¦°ê³¼ ì²«í™”ë©´ ì˜ˆì‹œ

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f951cd7f-eefe-4abe-a1a1-5211f24f80ab/_2021-06-28__9.48.53.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f951cd7f-eefe-4abe-a1a1-5211f24f80ab/_2021-06-28__9.48.53.png)

- ì´ë ‡ê²Œ ì„¤ê³„í•´ë„, ì˜ëª»ëœ ê²ƒì€ ì•„ë‹ˆì§€ë§Œ ìœ ì €ì…ì¥ì—ì„œëŠ” ì•±ì´ ì´ìƒí•˜ë‹¤ê³  ëŠë‚„ ìˆ˜ë„ ìˆë‹¤.

### 1-1. ìš”ì•½

1. ë””ìŠ¤íŒ¨ì¹˜ê·¸ë£¹ì€ ì—¬ëŸ¬ê°œì˜ ì‘ì—…ë“¤ì´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‹œì ìœ¼ë¡œ ì‹¤í–‰ë˜ê³  ìˆì„ ë•Œ, ì‘ì—…ë“¤ì„ "ê·¸ë£¹í™”"í•´ì„œ í•´ë‹¹ ì‘ì—…ë“¤ì˜ ì „ì²´ ì¢…ë£Œì‹œì ì„ ì•Œê¸°ìœ„í•œ ê°œë…ì´ë‹¤.

### 1-2.ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹ì˜ ì‚¬ìš©

- ë¹„ë™ê¸°ì²˜ë¦¬ë‚´ì—ì„œ ë™ê¸°ì ì¸ í•¨ìˆ˜ë§Œ ì‚¬ìš©í•  ê²½ìš°

- ë¹„ë™ê¸°ì²˜ë¦¬ë‚´ì—ì„œ ë¹„ë™ê¸°ì ì¸ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ê²½ìš°

  (ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹ì˜ enter(), leave() ë©”ì„œë“œë¥¼ ì‚¬ìš©)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/51224c41-e546-4ccb-b61d-3571670e02d4/_2021-06-28__9.51.17.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/51224c41-e546-4ccb-b61d-3571670e02d4/_2021-06-28__9.51.17.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2d14a6d1-32d6-47f7-8df8-06af8edb1b0a/_2021-06-28__9.52.12.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2d14a6d1-32d6-47f7-8df8-06af8edb1b0a/_2021-06-28__9.52.12.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0de09bb4-0164-4ad4-ad70-8fad7e907d5e/_2021-06-28__9.52.28.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0de09bb4-0164-4ad4-ad70-8fad7e907d5e/_2021-06-28__9.52.28.png)

ex) xcode íŒŒì¼ 1-1. DispatchGroup

```swift
import UIKit
import PlaygroundSupport
PlaygroundPage.current.needsIndefiniteExecution = true

//////////////////////////////////////////////////////////

// ì˜¤ë˜ê±¸ë¦¬ëŠ” í•¨ìˆ˜ ì •ì˜ (ë‚´ë¶€ëŠ” ë™ê¸°ì ì¸ ì‘ì—…)
func slowAdd(_ input: (Int, Int)) -> Int {
    sleep(2)
    return input.0 + input.1
}

//////////////////////////////////////////////////////////

//: # ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹
//: ### ê·¸ë£¹ì§€ì–´ì§„ ë¹„ë™ê¸° ì‘ì—…ë“¤ì´ ì–´ëŠì‹œì ì— ëª¨ë‘ ì™„ë£Œí•˜ëŠ” ì§€ê°€ ê´€ì‹¬
//: ### (1) ë¹„ë™ê¸°ì²˜ë¦¬ ë‚´ì—ì„œ ë™ê¸°ì ì¸ í•¨ìˆ˜ë§Œ ì‚¬ìš©í•  ê²½ìš°

let numberArray = [(0,1), (2,3), (4,5), (6,7), (8,9), (10,11)]

//: 1) "ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹" ìƒì„±í•˜ê¸°
// ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹ ìƒì„±
let group1 = DispatchGroup()        // ë””í´íŠ¸ ì´ë‹ˆì…œë¼ì´ì ¸ë¡œ "ë””ìŠ¤íŒ¨ì¹˜ê·¸ë£¹" ìƒì„±í•˜ê¸°

//: 2) ì‘ì—…ë“¤ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë³´ë‚¼ë•Œ "ê·¸ë£¹ ê¼¬ë¦¬í‘œ" ë¶™ì´ê¸°
for inValue in numberArray {
    // ìœ„ì—ì„œ ìƒì„±í•œ ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹ì„ ì•„ê·œë¨¼íŠ¸ì— ë„£ê¸°
    DispatchQueue.global(qos: .utility).async(group: group1) {
        // ë‚´ë¶€ì—” ë™ê¸°ì ì¸ í•¨ìˆ˜ë§Œ ì¡´ì¬
        let result = slowAdd(inValue)
        print("ê²°ê³¼ê°’ ì¶œë ¥ = \\(result)")
        
        
    }
}

//: 3) ê·¸ë£¹ì˜ ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œí–ˆì„ë•Œ ì•Œë¦¼(notify) ë°›ê¸°
let defaultQueue = DispatchQueue.global()

// ê·¸ë£¹ì˜ notify. ì‘ì—…ì´ ì™„ë£Œí•˜ê³  ì–´ë–¤ ì¼ì„ í•  ê²ƒì¸ì§€ ì •í•˜ê¸°
group1.notify(queue: defaultQueue) {
    print("====ê·¸ë£¹1 ì•ˆì˜ ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œ====")
    PlaygroundPage.current.finishExecution()
}
```

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2fbedeb6-2cbb-4583-9b9d-971c5bf4eb6c/_2021-06-28__9.57.28.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2fbedeb6-2cbb-4583-9b9d-971c5bf4eb6c/_2021-06-28__9.57.28.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4abc3888-3b83-41be-8d08-84b86b6ac982/_2021-06-28__9.57.42.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4abc3888-3b83-41be-8d08-84b86b6ac982/_2021-06-28__9.57.42.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ae5c7ffc-dd6d-470f-aeab-077553335cfc/_2021-06-28__9.57.59.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ae5c7ffc-dd6d-470f-aeab-077553335cfc/_2021-06-28__9.57.59.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3fef8849-b375-4b19-b281-629e6bab1596/_2021-06-28__9.58.45.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3fef8849-b375-4b19-b281-629e6bab1596/_2021-06-28__9.58.45.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6302029c-b683-46b8-9ada-f1a2a54e5fba/_2021-06-28__9.58.58.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6302029c-b683-46b8-9ada-f1a2a54e5fba/_2021-06-28__9.58.58.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/45858f51-eb2f-45cf-9b58-8a0922ad7bd3/_2021-06-28__9.59.14.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/45858f51-eb2f-45cf-9b58-8a0922ad7bd3/_2021-06-28__9.59.14.png)

- ì…ì¥ì´ 5ê°œê°€ ë˜ì—ˆìœ¼ë©´ í‡´ì¥ë„ 5ê°œê°€ ë˜ì–´ì•¼í•œë‹¤.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bba97c5c-a416-4049-97d0-fb5383b3cc54/_2021-06-28__10.00.07.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bba97c5c-a416-4049-97d0-fb5383b3cc54/_2021-06-28__10.00.07.png)

```swift
import Foundation
import PlaygroundSupport
PlaygroundPage.current.needsIndefiniteExecution = true

//////////////////////////////////////////////////////////

// ì˜¤ë˜ê±¸ë¦¬ëŠ” í•¨ìˆ˜ ì •ì˜ (ë‚´ë¶€ëŠ” ë™ê¸°ì ì¸ ì‘ì—…)
func slowAdd(_ input: (Int, Int)) -> Int {
    sleep(2)
    return input.0 + input.1
}

// ìœ„ì˜ í•¨ìˆ˜ë¥¼ ==> ë¹„ë™ê¸°ì ì¸ í•¨ìˆ˜ë¡œ ë³€í˜•
func asyncSlowAdd(_ input: (Int, Int), completion: @escaping (Int) -> ()) {
    DispatchQueue.global(qos: .utility).async {
        let result = slowAdd(input)
        completion(result)
    }
}

//////////////////////////////////////////////////////////

//: # ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹
//: ### ê·¸ë£¹ì§€ì–´ì§„ ë¹„ë™ê¸° ì‘ì—…ë“¤ì´ ì–´ëŠì‹œì ì— ëª¨ë‘ ì™„ë£Œí•˜ëŠ” ì§€ê°€ ê´€ì‹¬
//: ### (2) ë¹„ë™ê¸°ì²˜ë¦¬ ë‚´ì—ì„œ, ë¹„ë™ê¸°ì ì¸ í•¨ìˆ˜ë„ ì¡´ì¬í•˜ëŠ” ê²½ìš°

let numberArray = [(0,1), (2,3), (4,5), (6,7), (8,9), (10,11)]

// ë””ìŠ¤íŒ¨ì¹˜ ê·¸ë£¹ ìƒì„±
let group2 = DispatchGroup()

// ë°˜ë³µë¬¸ìœ¼ë¡œ ë¹„ë™ê¸° ê·¸ë£¹í•¨ìˆ˜ í™œìš©í•˜ê¸°
for pair in numberArray {
    DispatchQueue.global(qos: .utility).async(group: group2) {
        group2.enter()
        asyncSlowAdd(pair) { (result) in
            print("ê²°ê³¼ê°’ ì¶œë ¥ = \\(result)")
            group2.leave()
        }
    }
}

let defaultQueue = DispatchQueue.global()

// ëª¨ë“  ë¹„ë™ê¸° ì‘ì—…ì´ ëë‚¨ì„ ì•Œë¦¼ë°›ê¸°
group2.notify(queue: defaultQueue) {
    print("====ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œ ë˜ì—ˆìŠµë‹ˆë‹¤.====")
    PlaygroundPage.current.finishExecution()
}
```

- enter(), leave()ë¥¼ ë„£ì–´ì¤˜ì•¼í•¨.

  ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3cf76b19-5309-422a-a7d5-a693fcb20d5d/_2021-06-28__10.03.51.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3cf76b19-5309-422a-a7d5-a693fcb20d5d/_2021-06-28__10.03.51.png)

### 1-2. ìš”ì•½

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c8225373-c9e8-46ee-a399-ab175b6a0cd9/_2021-06-28__10.04.29.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c8225373-c9e8-46ee-a399-ab175b6a0cd9/_2021-06-28__10.04.29.png)

### 1-3. (ì°¸ê³ ) Dispatch WorkItem

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e29eda4a-5cf2-4e00-9848-73c1fd2ea17f/_2021-06-28__10.05.12.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e29eda4a-5cf2-4e00-9848-73c1fd2ea17f/_2021-06-28__10.05.12.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8d235ff3-b2d1-40bb-b960-14d2f9d8879b/_2021-06-28__10.06.22.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8d235ff3-b2d1-40bb-b960-14d2f9d8879b/_2021-06-28__10.06.22.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5b7a56a8-fcf8-42f3-bfe7-8085b905161e/_2021-06-28__10.06.57.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5b7a56a8-fcf8-42f3-bfe7-8085b905161e/_2021-06-28__10.06.57.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1c721b5d-ed97-4d4b-b99c-8585d8a2e92c/_2021-06-28__10.08.16.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1c721b5d-ed97-4d4b-b99c-8585d8a2e92c/_2021-06-28__10.08.16.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/00e45a9d-6230-4368-a209-db804f0b39a7/_2021-06-28__10.08.26.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/00e45a9d-6230-4368-a209-db804f0b39a7/_2021-06-28__10.08.26.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5ef7cc3c-53f4-424d-9bd1-58da481fb8bb/_2021-06-28__10.08.35.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5ef7cc3c-53f4-424d-9bd1-58da481fb8bb/_2021-06-28__10.08.35.png)

```swift
import UIKit
import PlaygroundSupport
PlaygroundPage.current.needsIndefiniteExecution = true

//: # DispatchWorkItem
//: ### ì‘ì—…ì„ í´ë¡œì €ì— ë‹´ì•„ ë¯¸ë¦¬ ìƒì„±í•œ í›„(ìº¡ìŠí™”), ë‚˜ì¤‘ì— ì‚¬ìš©ê°€ëŠ¥í•œ ë°©ë²•

let item1 = DispatchWorkItem(qos: .utility) {
    print("Task 1 ì‹œì‘")
    sleep(2)
    print("Task 1 ì™„ë£Œâ˜…")
}

let item2 = DispatchWorkItem(qos: .utility) {
    print("Task 2 ì‹œì‘")
    print("Task 2 ì™„ë£Œâ˜…")
}

let queue = DispatchQueue(label: "serial")

queue.async(execute: item1)
queue.async(execute: item2)

// Task 1ì‹œì‘
// Task 1ì™„ë£Œâ˜…
// Task 2ì‹œì‘
// Task 2ì™„ë£Œâ˜…

let queueGlobal = DispatchQueue.global()

queueGlobal.async(execute: item1)
queueGlobal.async(execute: item2)

// Task 1ì‹œì‘
// Task 2ì‹œì‘
// Task 1ì™„ë£Œâ˜…
// Task 2ì™„ë£Œâ˜…

//: 1. DispatchWorkItemì˜ ë¹ˆì•½í•œ <ì·¨ì†Œ> ê¸°ëŠ¥

sleep(3)
item2.cancel()

//ë˜ ë‹¤ë¥¸ í•¨ìˆ˜ë‚´ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš© ê°€ëŠ¥
//if item2.isCancelled {
//
//}
//: 2. DispatchWorkItemì˜ ë¹ˆì•½í•œ <ìˆœì„œ> ê¸°ëŠ¥

let queue2 = DispatchQueue(label: "concurrent", attributes: .concurrent)

let workItem3 = DispatchWorkItem {
    print("Task 3 ì‹œì‘")
    sleep(2)
    print("Task 3 ì™„ë£Œâ˜…")
}

let workItem4 = DispatchWorkItem {
    print("Task 4 ì‹œì‘")
    print("Task 4 ì™„ë£Œâ˜…")
}

/* 
Task 3 ì‹œì‘
Task 3 ì™„ë£Œâ˜…
Task 4 ì‹œì‘
Task 4 ì™„ë£Œâ˜…
*/

// ë‹¤ìŒ ì‹¤í–‰í•  "ë””ìŠ¤íŒ¨ì¹˜ì›Œí¬ì•„ì´í…œ"ì„ ì§€ì •
workItem3.notify(queue: DispatchQueue.global(), execute: workItem4)

queue2.async(execute: workItem3)

sleep(4)
PlaygroundPage.current.finishExecution()
```

### 1-3. ìš”ì•½

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ff7baf93-e385-4f7c-9f4a-3047374ae005/_2021-06-28__10.10.32.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ff7baf93-e385-4f7c-9f4a-3047374ae005/_2021-06-28__10.10.32.png)

### 1-4. (ì‹¬í™”) Semaphoreì˜ ì´í•´

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/63eeb381-003d-4539-bff0-1c5a3b156673/_2021-06-28__10.17.35.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/63eeb381-003d-4539-bff0-1c5a3b156673/_2021-06-28__10.17.35.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/155f508a-2ef2-42b1-809f-18c86ec92dc7/_2021-06-28__10.18.45.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/155f508a-2ef2-42b1-809f-18c86ec92dc7/_2021-06-28__10.18.45.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e0978703-6aaa-4f80-8e86-84bba7c29a9e/_2021-06-28__10.19.46.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e0978703-6aaa-4f80-8e86-84bba7c29a9e/_2021-06-28__10.19.46.png)

- wait() - ë‚´ê°€ ì‹ í˜¸ë¥¼ ì¤„ ë•Œê¹Œì§€ ì¼ë‹¨ ê¸°ë‹¤ë ¤ë¼!

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/dc6d6e41-8b32-41ac-abbe-61d41bcb2ac8/_2021-06-28__10.20.22.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/dc6d6e41-8b32-41ac-abbe-61d41bcb2ac8/_2021-06-28__10.20.22.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5f279aca-0b99-461c-a367-930564a5f2a8/_2021-06-28__10.21.26.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5f279aca-0b99-461c-a367-930564a5f2a8/_2021-06-28__10.21.26.png)

- signal() - ì‹ í˜¸ë¥¼ ì¤€ë‹¤.
- í•œ ì‹œì ì€ 3ê°œë¡œ ì œí•œ.

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a4a0d784-0d76-4043-8405-cad0ca1ca5b8/_2021-06-28__10.22.02.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a4a0d784-0d76-4043-8405-cad0ca1ca5b8/_2021-06-28__10.22.02.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f252fa25-2afe-4467-bd02-a23592f50520/_2021-06-28__10.22.12.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f252fa25-2afe-4467-bd02-a23592f50520/_2021-06-28__10.22.12.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c4ce1b2d-f559-4561-a72b-07721a4f35a9/_2021-06-28__10.22.54.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c4ce1b2d-f559-4561-a72b-07721a4f35a9/_2021-06-28__10.22.54.png)

```swift
import UIKit
import PlaygroundSupport
PlaygroundPage.current.needsIndefiniteExecution = true

//: # ë””ìŠ¤íŒ¨ì¹˜ì„¸ë§ˆí¬ì–´(DispatchSemaphore)
//: ### ìˆ˜ê¸°ì‹ í˜¸: ê³µìœ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ê°€ëŠ¥í•œ ì‘ì—… ìˆ˜ë¥¼ ì œí•œí•´ì•¼í•˜ëŠ” ê²½ìš°

let group = DispatchGroup()
let queue = DispatchQueue.global()

// ê³µìœ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ê°€ëŠ¥í•œ ì‘ì—…ìˆ˜ë¥¼ 3ê°œë¡œ ì œí•œ
let semaphore = DispatchSemaphore(value: 3)

for i in 1...10 {
    group.enter()
    semaphore.wait()
    queue.async(group: group) {
        // ë‹¤ìš´ë¡œë“œ ì‹œë®¬ë ˆì´íŒ…
        print("ì‹œë®¬ë ˆì´íŒ… \\(i)ì‹œì‘")
        sleep(3)
        print("ì‹œë®¬ë ˆì´íŒ… \\(i)ì¢…ë£Œâ˜…")
        semaphore.signal()
        group.leave()
    }
}

group.notify(queue: DispatchQueue.global()) {
    print("=====ëª¨ë“  ì¼ì´ ì¢…ë£Œë¨=====")
}
//: ## ì‹¤ì œ ë‹¤ìš´ë¡œë“œë¥¼ ì„¸ë§ˆí¬ì–´ë¡œ ì œí•œí•˜ëŠ” ì˜ˆì œ
//: ### ì•ì˜ ì˜ˆì œ(AnotherEample)ë¥¼ í™œìš©í•˜ì—¬ ì„¸ë§ˆí¬ì–´ë¡œ ì œí•œ

let downloadGroup = DispatchGroup()

// unsplash.com ë¬´ë£Œ ì´ë¯¸ì§€ ì‚¬ì´íŠ¸
let base = "<https://images.unsplash.com/photo->"

let imageNames = [
    "1579962413362-65c6d6ba55de?ixlib=rb-1.2.1&auto=format&fit=crop&w=934&q=80",
    "1580394693981-254c3aeded6a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=3326&q=80",
    "1579202673506-ca3ce28943ef?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=934&q=80",
    "1535745049887-3cd1c8aef237?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=934&q=80",
    "1568389494699-9076492b22e7?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=937&q=80",
    "1566624790190-511a09f6ddbd?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=934&q=80"
]

let userQueue = DispatchQueue.global(qos: .userInitiated)
let downloadSemaphore = DispatchSemaphore(value: 4)

var downloadedImages: [UIImage] = []

for name in imageNames {
    guard let url = URL(string: "\\(base)\\(name)") else { continue }
    
    group.enter()
    downloadSemaphore.wait()
    
    URLSession.shared.dataTask(with: url) { data, _, error in
        defer { // - ê°€ì¥ ë§ˆì§€ë§‰ìœ¼ë¡œ ë¯¸ë£¬ë‹¤.
            downloadSemaphore.signal()
            group.leave()
        }
        
        if error == nil, let data = data, let image = UIImage(data: data) {
            DispatchQueue(label: "serial").async {
                downloadedImages.append(image)
            }
        }
    }.resume()
}

group.notify(queue: userQueue) {
    print("=====ëª¨ë“  ë‹¤ìš´ë¡œë“œ ì™„ë£Œ=====")
    downloadedImages
    // PlaygroundPage.current.finishExecution()
}
```

### 1-4.  ìš”ì•½

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3f7acc7d-196a-4157-adfb-c22c20c48f23/_2021-06-28__10.23.13.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3f7acc7d-196a-4157-adfb-c22c20c48f23/_2021-06-28__10.23.13.png)

## 2. Thread-safeí•œ ì½”ë“œì˜ êµ¬í˜„ê³¼ ë°©ë²•

### 2-1. TSan ì‚¬ìš©ë²• - ë‹¤ì‹œ ë³¼ê²ƒ

### 2-2. ì‹œë¦¬ì–¼íì™€ sync

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/191307e6-c6ae-49d5-948d-88d7622e12c2/_2021-06-28__10.40.47.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/191307e6-c6ae-49d5-948d-88d7622e12c2/_2021-06-28__10.40.47.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/551a9955-fe49-43c2-b134-24f78c9d71b4/_2021-06-28__10.41.50.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/551a9955-fe49-43c2-b134-24f78c9d71b4/_2021-06-28__10.41.50.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/05b94970-b3f0-42fc-8b6b-43c033a71325/_2021-06-28__10.42.37.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/05b94970-b3f0-42fc-8b6b-43c033a71325/_2021-06-28__10.42.37.png)

### 2-2. ìš”ì•½

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d9830d88-b16f-47ef-bc47-a63bd153678c/_2021-06-28__10.42.59.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d9830d88-b16f-47ef-bc47-a63bd153678c/_2021-06-28__10.42.59.png)

### 2-3. Perso ê°ì²´ì˜ ì˜ˆì‹œ

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/488e919e-7256-4d39-8f0c-a3dee88ac06f/_2021-06-28__10.46.19.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/488e919e-7256-4d39-8f0c-a3dee88ac06f/_2021-06-28__10.46.19.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1c615cb0-d19f-4639-a2b9-c28cd6e1bed5/_2021-06-28__10.46.28.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1c615cb0-d19f-4639-a2b9-c28cd6e1bed5/_2021-06-28__10.46.28.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/435b258b-4e66-4eda-a7cc-2959e0d60341/_2021-06-28__10.46.51.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/435b258b-4e66-4eda-a7cc-2959e0d60341/_2021-06-28__10.46.51.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/69a17c02-8267-4d53-a88f-0cbee5028f20/_2021-06-28__10.55.47.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/69a17c02-8267-4d53-a88f-0cbee5028f20/_2021-06-28__10.55.47.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f6c3951a-bdef-4bdf-993d-bb29b46eff05/_2021-06-28__10.56.19.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f6c3951a-bdef-4bdf-993d-bb29b46eff05/_2021-06-28__10.56.19.png)

## 3. GCD í”„ë¡œì íŠ¸ ì‚´í´ë³´ê¸°

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/67a3d008-ec79-49c2-998d-154ee04f6d52/_2021-06-28__11.03.18.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/67a3d008-ec79-49c2-998d-154ee04f6d52/_2021-06-28__11.03.18.png)

## 4. Operation / OperationQueue

### 4-1. GCDì™€ OperationQueueì˜ ì°¨ì´

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/931221b4-a0ff-4f55-8013-7397026aa0ed/_2021-06-28__11.05.23.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/931221b4-a0ff-4f55-8013-7397026aa0ed/_2021-06-28__11.05.23.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/79d56b64-e6f9-46c8-8260-0b5303b257e6/_2021-06-28__11.06.38.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/79d56b64-e6f9-46c8-8260-0b5303b257e6/_2021-06-28__11.06.38.png)

### 4-2. Operation

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/090446ba-d4ab-4dfb-a656-1632f9fb0e57/_2021-06-28__11.07.11.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/090446ba-d4ab-4dfb-a656-1632f9fb0e57/_2021-06-28__11.07.11.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8c6d30a3-4896-42a9-bfb3-76a8747d1e27/_2021-06-28__11.08.45.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8c6d30a3-4896-42a9-bfb3-76a8747d1e27/_2021-06-28__11.08.45.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fa1286a4-f1c0-453b-b887-bb526cd77de6/_2021-06-28__11.18.59.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fa1286a4-f1c0-453b-b887-bb526cd77de6/_2021-06-28__11.18.59.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7f803107-8bcf-44b3-8775-dcc8ad48f8b9/_2021-06-28__11.19.38.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7f803107-8bcf-44b3-8775-dcc8ad48f8b9/_2021-06-28__11.19.38.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2db7628c-f034-474f-9fb7-8ebd44a78df8/_2021-06-28__11.19.47.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2db7628c-f034-474f-9fb7-8ebd44a78df8/_2021-06-28__11.19.47.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4f7a23e5-182a-414b-a6f2-637f3411f366/_2021-06-28__11.21.39.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4f7a23e5-182a-414b-a6f2-637f3411f366/_2021-06-28__11.21.39.png)

### 4-2. ìš”ì•½

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/62fdc702-b8fa-4bc3-9e36-da9c2c710790/_2021-06-28__11.21.51.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/62fdc702-b8fa-4bc3-9e36-da9c2c710790/_2021-06-28__11.21.51.png)

### 4-3. ì˜¤í¼ë ˆì´ì…˜ í

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7708d3a7-570f-4dfd-aaee-b67be391433f/_2021-06-28__11.22.38.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7708d3a7-570f-4dfd-aaee-b67be391433f/_2021-06-28__11.22.38.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/da450bc0-6b54-479e-bf8c-1c0c78a4700c/_2021-06-28__11.22.54.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/da450bc0-6b54-479e-bf8c-1c0c78a4700c/_2021-06-28__11.22.54.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4cc53f7c-44d0-4c1a-bfeb-2ba63396dca1/_2021-06-28__11.23.06.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4cc53f7c-44d0-4c1a-bfeb-2ba63396dca1/_2021-06-28__11.23.06.png)

- waituntilAllOperationsAreFinished() - ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘ ì‹œí‚¤ë©´ ì•ˆë¨

```swift
//: ## ì˜¤í¼ë ˆì´ì…˜í ë§Œë“¤ê¸°
//: ê°„ë‹¨í•˜ê²Œ í´ë¡œì €ë¥¼ ë”í•  ìˆ˜ ìˆëŠ” ì˜¤í¼ë ˆì´ì…˜í ë§Œë“¤ê¸°

// ì˜¤í¼ë ˆì´ì…˜í ìƒì„±
let opQueue = OperationQueue()

// ì‚¬ìš©í•  ìµœëŒ€ì˜ ì“°ë ˆë“œ ê°¯ìˆ˜ë¥¼ ì •ì˜(ê¸°ë³¸ì„¤ì •ì€ -1)
// 1ë¡œ ì„¤ì •í•˜ë©´ ì‹œë¦¬ì–¼ë¡œ ì‚¬ìš©
opQueue.maxConcurrentOperationCount = 1

// ê°„ë‹¨í•œ ì‘ì—…ì„ DispatchQueue.global().async { } ë°©ì‹ì²˜ëŸ¼ ë„£ëŠ” ê²ƒë„ ê°€ëŠ¥ì€ í•¨

opQueue.addOperation { print("Hello,"); sleep(3) }
opQueue.addOperation { print("Swift"); sleep(3) }

// ë™ê¸°ì ìœ¼ë¡œ ëª¨ë“  ì˜¤í¼ë ˆì´ì…˜í ì•ˆì˜ ì‘ì—…ì„ ì™„ë£Œí• ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸° ìœ„í•œ ë©”ì„œë“œ
// (ì‹¤ì œ ì•±ì—ì„  ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰í•˜ë©´ ì ˆëŒ€ ì•ˆë¨)

opQueue.waitUntilAllOperationsAreFinished()

//: ## ì˜¤í¼ë ˆì´ì…˜íì˜ ì„¤ì •
// ì°¸ê³ ===============================
opQueue.qualityOfService = .utility
opQueue.underlyingQueue = .global()
// ==================================
//: ## ì¼ë°˜ì ì¸ ì˜¤í¼ë ˆì´ì…˜ê³¼ ì˜¤í¼ë ˆì´ì…˜íì˜ ì‚¬ìš©

//: ì´ë¯¸ì§€ë°°ì—´ì„ í•„í„°ë¥¼ ì ìš©í•´ì„œ ë³€í˜•í•´ë³´ê³ , í„í„° ì ìš©ëœ ë‹¤ë¥¸ ë°°ì—´ ë§Œë“¤ì–´ ë³´ê¸°
let images = ["city", "dark_road", "train_day", "train_dusk", "train_night"].map { UIImage(named: "\\($0).jpg") }

// í•„í„°ëœ ì´ë¯¸ì§€ ì €ì¥í•  ë°°ì—´ (ë™ì‹œì„± ë¬¸ì œ ë°œìƒí•  ìˆ˜ ìˆì–´ì„œ, ì‹œë¦¬ì–¼íì—ì„œ append)
var filteredImages = [UIImage]()

//: 1) Step1: ì‚¬ìš©í•  ì˜¤í¼ë ˆì´ì…˜ íë“¤ì„ ìƒì„±í•˜ê¸°
// í•„í„°(ì´ë¯¸ì§€ë³€í˜•)ì˜¤í¼ë ˆì´ì…˜ë“¤ì„ ë„£ì„ ì˜¤í¼ë ˆì´ì…˜í
let filterQueue = OperationQueue()

// ë™ì‹œì„± ë¬¸ì œë¥¼ ì—†ì• ê¸° ìœ„í•œ ë˜ë‹¤ë¥¸ ì§ë ¬í
let appendQueue = OperationQueue()
appendQueue.maxConcurrentOperationCount = 1

//: 2) Step2: ì‹¤ì œ ì˜¤í¼ë ˆì´ì…˜ìƒì„±í•´ì„œ ì˜¤í¼ë ˆì´ì…˜ íì— ë„£ê¸°
for image in images {
    // ê°ê°ì˜ ì´ë¯¸ì§€ë¥¼ í•„í„°ë§í•˜ëŠ” ì‘ì—…ì´ "ê° 1ê°œì˜ ì˜¤í¼ë ˆì´ì…˜"ì„.
    let filterOp = TiltShiftOperation()
    filterOp.inputImage = image
    
    // ì˜¤í¼ë ˆì´ì…˜ì´ ì™„ë£Œë˜ë©´, "appendQueue"ë¡œ ë³´ë‚´ì„œ ë°°ì—´ì— appendí•  ìˆ˜ìˆë„ë¡ í•¨.
    filterOp.completionBlock = {
        guard let output = filterOp.outputImage else { return }
        appendQueue.addOperation {
            filteredImages.append(output)
        }
    }
    
    // ì´ì œ ì´ë ‡ê²Œ ë§Œë“  ì‘ì—…ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì˜¤í¼ë ˆì´ì…˜íì— ë³´ë‚´ê¸° â­ï¸
    filterQueue.addOperation(filterOp)      // DispatchQueue.global().async { } ì™€ ê°™ì€
}

//: 3) Step3: ì‹¤ì œ ë³€í˜• ë°°ì—´ ê²°ê³¼ í™•ì¸í•˜ê¸°
// ì—¬ê¸°ì„œ í™•ì¸í•˜ë©´ ì•ˆë¨
// filteredImages

// ëª¨ë“  ì´ë¯¸ì§€ ë³€í˜•ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°

filterQueue.waitUntilAllOperationsAreFinished()

// ë°°ì—´í™•ì¸í•´ ë³´ê¸°
filteredImages

PlaygroundPage.current.finishExecution()
```

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e183b176-4ba1-4268-8fed-f2f0b35e5b5d/_2021-06-28__11.32.16.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e183b176-4ba1-4268-8fed-f2f0b35e5b5d/_2021-06-28__11.32.16.png)

## 5. AsyncOperation (ë¹„ë™ê¸° ì˜¤í¼ë ˆì´ì…˜)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/76a8f034-2541-41e6-8e3d-357b07cee478/_2021-06-28__11.47.24.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/76a8f034-2541-41e6-8e3d-357b07cee478/_2021-06-28__11.47.24.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1859852f-7610-419b-b9aa-79ff07e5c96a/_2021-06-28__11.48.34.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1859852f-7610-419b-b9aa-79ff07e5c96a/_2021-06-28__11.48.34.png)

- ìƒíƒœì— ëŒ€í•œ ìˆ˜ë™ ê´€ë¦¬ê°€ í•„ìš”

```swift
//: ## ì¶”ìƒë¹„ë™ê¸°ì˜¤í¼ë ˆì´ì…˜(í•„ìš”í• ë•Œ, ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ë©´ ë¨)

// ì¶”ìƒ ë¹„ë™ê¸° ì˜¤í¼ë ˆì´ì…˜ì˜ ì •ì˜
class AsyncOperation: Operation {
    // Enum ìƒì„±
    enum State: String {
        case ready, executing, finished
        
        // KVO notificationsì„ ìœ„í•œ keyPathì„¤ì •
        fileprivate var keyPath: String {
            return "is\\(rawValue.capitalized)"
        } // isReady/isExecuting/isFinished
    }
    
    // ì§ì ‘ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ìƒíƒœ ë³€ìˆ˜ ìƒì„±
    var state = State.ready {
        willSet {
            willChangeValue(forKey: newValue.keyPath)
            willChangeValue(forKey: state.keyPath)
        }
        didSet {
            didChangeValue(forKey: oldValue.keyPath)
            didChangeValue(forKey: state.keyPath)
        }
    }
}

extension AsyncOperation {
    // ìƒíƒœì†ì„±ì€ ëª¨ë‘ read-only
    override var isReady: Bool {
        return super.isReady && state == .ready
    }
    
    override var isExecuting: Bool {
        return state == .executing
    }
    
    override var isFinished: Bool {
        return state == .finished
    }
    
    override var isAsynchronous: Bool {  // ë¬´ì¡°ê±´ trueë¡œ ë¦¬í„´
        return true
    }
    
    override func start() {
        if isCancelled {
            state = .finished
            return
        }
        main()
        state = .executing
    }
    
    override func cancel() {
        super.cancel()
        state = .finished
    }
}
```

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/252d8865-b516-4ac3-bc93-d8c6a3d56162/_2021-06-28__11.57.02.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/252d8865-b516-4ac3-bc93-d8c6a3d56162/_2021-06-28__11.57.02.png)

- ì§ì ‘ êµ¬í˜„í•  í•„ìš”ëŠ” ì—†ê³  ìœ„ì— ì½”ë“œë¥¼ ê°€ì ¸ë‹¤ ì“°ë©´ ëœë‹¤.

### 5-1. ìš”ì•½

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c1c83212-b24a-41c0-9e70-434bff5daa15/_2021-06-28__11.57.20.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c1c83212-b24a-41c0-9e70-434bff5daa15/_2021-06-28__11.57.20.png)

## 6. ì˜¤í¼ë ˆì´ì…˜íì˜ ì£¼ìš”ê¸°ëŠ¥

### 6-1. ì˜¤í¼ë ˆì´ì…˜íì˜ ì‘ì—… ì·¨ì†Œ

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c1ff92fe-55eb-44d8-853a-54018d50d34a/_2021-06-28__11.58.32.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c1ff92fe-55eb-44d8-853a-54018d50d34a/_2021-06-28__11.58.32.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/352fdecb-c096-4352-b5fe-eb3b841ad416/_2021-06-28__11.59.11.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/352fdecb-c096-4352-b5fe-eb3b841ad416/_2021-06-28__11.59.11.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d0d1a213-bab0-4ebc-9858-5d5c2e240324/_2021-06-28__11.59.52.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d0d1a213-bab0-4ebc-9858-5d5c2e240324/_2021-06-28__11.59.52.png)

```swift
// ê¸°ë³¸ì˜¤í¼ë ˆì´ì…˜ ì •ì˜

class SumOperation: Operation {
    let inputPair: (Int, Int)
    var output: Int?
    
    init(input: (Int, Int)) {
        inputPair = input
        super.init()
    }
    
    override func main() {
        if isCancelled {
            return
        }   // ì‹¤ì œ ì·¨ì†Œë  ìˆ˜ ìˆë„ë¡ ==> ì´ëŸ° ì½”ë“œë¥¼ ì‚½ì…í•´ì•¼í•¨
        output = slowAdd(inputPair)
    }
}
//: ## ì˜¤í¼ë ˆì´ì…˜íì™€ ì˜¤í¼ë ˆì´ì…˜ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ê¸°ë³¸ GroupAddí´ë˜ìŠ¤
//: ### í´ë˜ìŠ¤ë‚´ì— (ë™ì‹œ)ì˜¤í¼ë ˆì´ì…˜í ë° (ì‹œë¦¬ì–¼)ì˜¤í¼ë ˆì´ì…˜íê°€ ë‹¤ ì¡´ì¬í•¨

class GroupAdd {
    let queue = OperationQueue()
    let appendQueue = OperationQueue()
    
    var outputArray = [(Int, Int, Int)]()
    
    init(input: [(Int, Int)]) {    // ë°°ì—´ì„ ê°€ì§€ê³  ìƒì„±
        // ì¼ë‹¨ ìƒì„±ì‹œ í ì¼ì‹œì¤‘ì§€ ì‹œì¼œë†“ê¸°
        queue.isSuspended = true
        queue.maxConcurrentOperationCount = 2
        appendQueue.maxConcurrentOperationCount = 1
        generateOperations(input)
    }
    
    // ë°˜ë³µë¬¸ìœ¼ë¡œ ì˜¤í¼ë ˆì´ì…˜ì„ ìƒì„±í•˜ëŠ” ë©”ì„œë“œ
    func generateOperations(_ numberArray: [(Int, Int)]) {
        for pair in numberArray {
            let sumOp = SumOperation(input: pair)
            sumOp.completionBlock = {
                if sumOp.isCancelled { return }
                guard let result = sumOp.output else { return }
                self.appendQueue.addOperation {
                    self.outputArray.append((pair.0, pair.1, result))
                }
            }
            queue.addOperation(sumOp)
        }
    }
    
    func start() {
        queue.isSuspended = false
    }
    
    func cancel() {
        queue.cancelAllOperations()
    }
    
    func wait() {
        queue.waitUntilAllOperationsAreFinished()
    }
}
//: ## ì •ì˜í•œ í´ë˜ìŠ¤ ì‚¬ìš©í•´ë³´ê¸°

let numberArray = [(1,2), (3,4), (5,6), (7,8), (9,10)]

// ëª¨ë‘ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ ìƒì„±í•˜ê¸°
let groupAdd = GroupAdd(input: numberArray)

groupAdd.start()   // ì˜¤í¼ë ˆì´ì…˜í ì‘ì—…ì‹œì‘

//: cancel()ë©”ì„œë“œ ì‹¤í—˜í•´ë³´ê¸°
sleep(2)
groupAdd.cancel()

//: ê²°ê³¼ê°’ ì‚´í´ë³´ê¸°
groupAdd.wait()
print(groupAdd.outputArray)

PlaygroundPage.current.finishExecution()
```

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/23062c23-9af0-47fa-a1a9-6addafd3668a/_2021-06-28__12.10.12.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/23062c23-9af0-47fa-a1a9-6addafd3668a/_2021-06-28__12.10.12.png)

### 6-2. ìˆœì„œê´€ë¦¬ (ì¢…ì†ì„± - Dependencies)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7d72280f-2b2c-4d47-9d73-605dc20cfb9a/_2021-06-28__12.12.05.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7d72280f-2b2c-4d47-9d73-605dc20cfb9a/_2021-06-28__12.12.05.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3c42c60a-4962-4741-bfad-647e01844e2f/_2021-06-28__12.17.54.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3c42c60a-4962-4741-bfad-647e01844e2f/_2021-06-28__12.17.54.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a53d8fb8-7677-4d21-839c-40f45494f4e4/_2021-06-28__12.18.13.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a53d8fb8-7677-4d21-839c-40f45494f4e4/_2021-06-28__12.18.13.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f7308549-826f-4d19-b890-23524246a7f4/_2021-06-28__12.18.05.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f7308549-826f-4d19-b890-23524246a7f4/_2021-06-28__12.18.05.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3954f81f-0747-46bb-8e87-ca20b80e0cd6/_2021-06-28__12.18.27.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3954f81f-0747-46bb-8e87-ca20b80e0cd6/_2021-06-28__12.18.27.png)

```swift
//: # ì˜ì¡´ì„± ì„¤ì •(ìˆœì„œì„¤ì •)í•˜ëŠ” ë°©ë²•
//: ### ì˜¤í¼ë ˆì´ì…˜ê°„ì˜ ìˆœì„œë¥¼ ì •í•˜ê³ , ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ë°©ë²•

//: ### ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ì²«ë²ˆì§¸ (ë¹„ë™ê¸°)ì˜¤í¼ë ˆì´ì…˜ ì •ì˜
// (1) ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë¹„ë™ê¸° ì˜¤í¼ë ˆì´ì…˜
class ImageLoadOperation: AsyncOperation {
    var inputName: String?
    var outputImage: UIImage?
    
    override func main() {
        // ì´ ë©”ì„œë“œëŠ” ì ê¹ sleepí–ˆë‹¤ê°€ ì´ë¯¸ì§€ë¥¼ ë°˜í™˜í•˜ëŠ” ì‹œë®¬ë ˆì´íŒ… ë©”ì„œë“œì„.
        simulateAsyncNetworkLoadImage(named: self.inputName) { [unowned self] (image) in
            self.outputImage = image
            self.state = .finished     // ìƒíƒœê´€ë¦¬ ìˆ˜ë™ â­ï¸
        }
    }
}
//: ### 2-1 ë°ì´í„°ì „ë‹¬ì„ ìœ„í•œ í”„ë¡œí† ì½œ ì •ì˜ ë° ì±„íƒ
// ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ê¸°ìœ„í•œ í”„ë¡œí† ì½œ ì •ì˜í•˜ê¸°
protocol FilterDataProvider {
    var image: UIImage? { get }
}

// í”„ë¡œí† ì½œ ì±„íƒí•´ì„œ ===> ê³„ì‚° ì†ì„±ìœ¼ë¡œ ì •ì˜
extension ImageLoadOperation: FilterDataProvider {
    var image: UIImage? {
        return outputImage
    }
}

//: ### 2-2 ë°ì´í„° ë½‘ì•„ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ ë‚´ìš©ì„ main()ì— ì •ì˜
// (2) ì´ë¯¸ì§€ ë³€í˜•í•˜ëŠ” ì˜¤í¼ë ˆì´ì…˜ (ë™ê¸° í•¨ìˆ˜)
class TiltShiftOperation: Operation {
    var inputImage: UIImage?
    var outputImage: UIImage?
    
    override func main() {
        // â­ï¸ 2) í”„ë¡œí† ì½œ ì±„íƒí•œ ì•ì˜ ì˜¤í¼ë ˆì´ì…˜ì—ì„œ, ì¸í’‹ê°’ì„ ì–»ì–´ë‚´ê¸°   // ì¸í’‹ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´
        if inputImage == .none,
           let provider = dependencies.filter({ $0 is FilterDataProvider})
                                      .first as? FilterDataProvider {   // (ì˜ì¡´í•˜ê³  ìˆëŠ”) ì˜¤í¼ë ˆì´ì…˜ì˜ ë°°ì—´ì—ì„œ ì˜¤í¼ë ˆì´ì…˜ êº¼ë‚´ê¸°
            inputImage = provider.image
        }
        
        // ì‹¤ì œ ì‘ì—…
        outputImage = tiltShift(image: inputImage)
    }
}

//: ### ì˜¤í¼ë ˆì´ì…˜ ìƒì„±
let imageLoad = ImageLoadOperation()
let filter = TiltShiftOperation()

imageLoad.inputName = "train_day.jpg"

//: ### ì˜ì¡´ì„± ì„¤ì •
// â­ï¸ ì˜ì¡´ì„± ì„¤ì • "filterì˜¤í¼ë ˆì´ì…˜"ì´ "imageLoadì˜¤í¼ë ˆì´ì…˜"ì— ì˜ì¡´í•œë‹¤.
filter.addDependency(imageLoad)

//: ### ë‘ê°œì˜ ì˜¤í¼ë ˆì´ì…˜ì„ ì˜¤í¼ë ˆì´ì…˜íì— ë„£ì–´ì„œ ì§„í–‰ í™•ì¸
let queue = OperationQueue()

// íì— ì˜¤í¼ë ˆì´ì…˜ ë„£ê¸° (ë™ê¸°ì ìœ¼ë¡œ ê¸°ë‹¤ë¦¬ê²Œ í•´ì„œ í™•ì¸í•´ë³´ê¸°)
queue.addOperations([imageLoad, filter], waitUntilFinished: true)

imageLoad.outputImage
filter.outputImage

sleep(3)
PlaygroundPage.current.finishExecution()
```

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/af558007-1abc-49ad-a995-f78f434b91f0/_2021-06-28__12.18.43.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/af558007-1abc-49ad-a995-f78f434b91f0/_2021-06-28__12.18.43.png)

## 7. ì˜¤í¼ë ˆì´ì…˜ í”„ë¡œì íŠ¸ ì‚´í´ë³´ê¸°

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5dfda765-43f4-4418-9e09-a168281a0222/_2021-06-28__12.27.58.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5dfda765-43f4-4418-9e09-a168281a0222/_2021-06-28__12.27.58.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/278530b4-0c60-4486-83dc-8a78849a2945/_2021-06-28__12.29.43.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/278530b4-0c60-4486-83dc-8a78849a2945/_2021-06-28__12.29.43.png)

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b9367dd7-35e6-4c51-aa79-9724fa6a16bb/_2021-06-28__12.29.56.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b9367dd7-35e6-4c51-aa79-9724fa6a16bb/_2021-06-28__12.29.56.png)

## 8. GCD / OperationQueue ë¹„êµ ì •ë¦¬

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/725cd257-03d1-4b8d-9a8e-d623a86f3161/_2021-06-28__12.40.35.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/725cd257-03d1-4b8d-9a8e-d623a86f3161/_2021-06-28__12.40.35.png)

<br/>

---



### ì˜¤ëŠ˜ì˜ ì‚½ì§ˆ â³

ë™ë„¤ ì£¼ë¯¼ `JM` ê³¼ swift server side Vaporë¥¼ ê°€ì§€ê³  ê³µë¶€í•˜ë©´ì„œ ì–˜ê¸°ë¥¼ ë‚˜ëˆ´ë‹¤. 

ë‘˜ì´ ì´í•´ëŠ” ì•ˆê°”ì§€ë§Œ yagom í˜ì´ì§€ì— ì˜¬ë¼ì˜¨ Vapor ê°•ì˜ë¥¼ ë³´ë©´ì„œ ë”°ë¼í•´ë´¤ë‹¤. í•˜ì§€ë§Œ `PostgresConfiguration` ì´ê²Œ ì—†ëŠ”ë°... ì™œ ì—†ì„ê¹Œ

ê·¸ë˜ì„œ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì„œ í•˜ë©´ ìˆë‹¤! ê·¼ë° í¬í¬ í•´ì˜¨ í”„ë¡œì íŠ¸ì—ëŠ” ì—†ë‹¤... ë­ê°€ ë¬¸ì œì¸ì§€ ë‚´ì¼ 9ì‹œì— ì¼ì–´ë‚˜ì„œ ì‚½ì§ˆì„ ë‹¤ì‹œí•  ì˜ˆì •ì´ë‹¤

<br/>

---



### ì˜¤ëŠ˜ì˜ ëŠë‚€ì  ğŸ˜

ì²œì²œíˆ ì°¨ê·¼ì°¨ê·¼ ì¡°ê¸‰í•˜ì§€ ì•Šê²Œ í•˜ë©´ ì–»ëŠ”ê²Œ ë”ìš± ë§ì„ ê²ƒ ê°™ë‹¤ ã…ã…

ì²˜ìŒë¶€í„° ì™„ë²½í•  ìˆ˜ ì—†ìœ¼ë‹ˆê¹Œ ìš°ì„  ë§Œë“¤ê³  ì§€ì†ì ìœ¼ë¡œ ê³ ì³ê°€ëŠ”ê²Œ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

<br/>

---





